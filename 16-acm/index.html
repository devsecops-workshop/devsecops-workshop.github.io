<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.0" />
    <meta name="description" content="A DevSecOps Workshop Day using openShift and ACS">
<meta name="author" content="GÃ¶tz, Daniel">

    <link rel="icon" href="https://devsecops-workshop.github.io/images/favicon.png" type="image/png">

    <title>Advanced Cluster Management :: DevSecOps Workshop</title>

    
    <link href="https://devsecops-workshop.github.io/css/nucleus.css?1712332138" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/fontawesome-all.min.css?1712332138" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/hybrid.css?1712332138" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/featherlight.min.css?1712332138" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/perfect-scrollbar.min.css?1712332138" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/auto-complete.css?1712332138" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/atom-one-dark-reasonable.css?1712332138" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/theme.css?1712332138" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/tabs.css?1712332138" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/hugo-theme.css?1712332138" rel="stylesheet">
    
    <link href="https://devsecops-workshop.github.io/css/theme-red.css?1712332138" rel="stylesheet">
    
    

    <script src="https://devsecops-workshop.github.io/js/jquery-3.3.1.min.js?1712332138"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
<script src="https://devsecops-workshop.github.io/js/custom.js"></script>
  </head>
  <body class="" data-url="/16-acm/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://devsecops-workshop.github.io/">
    <img src="https://devsecops-workshop.github.io/images/acs-logo.png">
  </a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://devsecops-workshop.github.io/js/lunr.min.js?1712332138"></script>
<script type="text/javascript" src="https://devsecops-workshop.github.io/js/auto-complete.js?1712332138"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/devsecops-workshop.github.io\/";
    
</script>
<script type="text/javascript" src="https://devsecops-workshop.github.io/js/search.js?1712332138"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='https://devsecops-workshop.github.io/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-intro/" title="The DevSecOps Workshop" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/1-intro/">
          The DevSecOps Workshop
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-install-prerequisites/" title="Install Prerequisites" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/2-install-prerequisites/">
          Install Prerequisites
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2.1-prepare-cluster/" title="Prepare Cluster" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/2.1-prepare-cluster/">
          Prepare Cluster
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-inner-loop/" title="Inner Loop" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/3-inner-loop/">
          Inner Loop
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-outer-loop/" title="Outer Loop" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/4-outer-loop/">
          Outer Loop
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-gitops/" title="Configure GitOps" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/5-gitops/">
          Configure GitOps
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/10-rhacs-setup/" title="Install and Configure ACS" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/10-rhacs-setup/">
          Install and Configure ACS
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/11-rhacs-warmup/" title="Getting to know ACS" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/11-rhacs-warmup/">
          Getting to know ACS
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/12-create-policy/" title="Create a Custom Security Policy" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/12-create-policy/">
          Create a Custom Security Policy
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/13-rhacs-pipeline/" title="Integrating ACS into the Pipeline" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/13-rhacs-pipeline/">
          Integrating ACS into the Pipeline
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/15-runtime-security/" title="Securing Runtime Events" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/15-runtime-security/">
          Securing Runtime Events
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/16-acm/" title="Advanced Cluster Management" class="dd-item
        
        active
        
        ">
      <a href="https://devsecops-workshop.github.io/16-acm/">
          Advanced Cluster Management
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/20-appendix/" title="Appendix" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/20-appendix/">
          Appendix
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://devsecops-workshop.github.io/"><i class='fas fa-home'></i> Homepage</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='https://devsecops-workshop.github.io/'></a> > Advanced Cluster Management
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#advanced-cluster-management-overview">Advanced Cluster Management Overview</a></li>
    <li><a href="#install-advanced-cluster-managagement">Install Advanced Cluster Managagement</a></li>
    <li><a href="#a-first-look-at-advanced-cluster-management">A first look at Advanced Cluster Management</a></li>
    <li><a href="#manage-cluster-lifecycle">Manage Cluster Lifecycle</a></li>
    <li><a href="#deploy-an-openshift-cluster">Deploy an OpenShift Cluster</a>
      <ul>
        <li><a href="#create-cloud-credentials">Create Cloud Credentials</a></li>
      </ul>
    </li>
    <li><a href="#deploy-single-node-openshift">Deploy Single Node OpenShift</a></li>
    <li><a href="#application-lifecycle-management">Application Lifecycle Management</a></li>
    <li><a href="#creating-a-simple-application-with-acm">Creating a Simple Application with ACM</a></li>
    <li><a href="#prepost-tasks-with-ansible-automation-platform-2">Pre/Post Tasks with Ansible Automation Platform 2</a>
      <ul>
        <li><a href="#install-automation-controller">Install Automation Controller</a></li>
        <li><a href="#add-auth-token">Add Auth Token</a></li>
        <li><a href="#configure-template-in-automation-controller">Configure Template in Automation Controller</a></li>
        <li><a href="#create-aap-credentials-in-acm">Create AAP credentials in ACM</a></li>
        <li><a href="#use-the-acm---ansible-integration">Use the ACM - Ansible integration</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Advanced Cluster Management
            </h1>
          

        



	<h2 id="advanced-cluster-management-overview">Advanced Cluster Management Overview</h2>
<p>Red Hat Advanced Cluster Management for Kubernetes (ACM) provides management, visibility and control for your OpenShift and Kubernetes environments. It provides management capabilities for:</p>
<ul>
<li>cluster creation</li>
<li>application lifecycle</li>
<li>security and compliance</li>
</ul>
<p>All across hybrid cloud environments.</p>
<p>Clusters and applications are visible and managed from a single console, with built-in security policies. Run your operations from anywhere that Red Hat OpenShift runs, and manage any Kubernetes cluster in your fleet.</p>
<h2 id="install-advanced-cluster-managagement">Install Advanced Cluster Managagement</h2>
<p>Before you can start using ACM, you have to install it using an Operator on your OpenShift cluster.</p>
<ul>
<li>Login to the OpenShift Webconsole with you cluster admin credentials</li>
<li>In the Web Console, go to <strong>Operators &gt; OperatorHub</strong> and search for the <code>Advanced Cluster Management for Kubernetes</code> operator.</li>
<li>Install the operator with default settings</li>
<li>It will install into a new <strong>Project</strong> <code>open-cluster-management</code> by default.</li>
</ul>
<p>After the operator has been installed it will inform you to create a <code>MultiClusterHub</code>, the central component of ACM.</p>
<figure>
    <img src="../images/acm-install1.png?width=30pc&amp;classes=border,shadow"/> <figcaption>
            <h4>Click image to enlarge</h4>
        </figcaption>
</figure>

<p>Click the <strong>Create MultiClusterHub</strong> button and have a look at the available installation parameters, but don&rsquo;t change anything.</p>
<p>Click <strong>Create</strong>.</p>
<p>At some point you will be asked to refresh the web console. Do this, you&rsquo;ll notice a new drop-down menu at the top of the left menu bar. If left set to <code>local-cluster</code> you get the standard console view, switching to <code>All Clusters</code> takes you to a view provided by ACM covering all your clusters.</p>
<p>Okay, right now you&rsquo;ll only see one, your <code>local-cluster</code> listend here.</p>
<h2 id="a-first-look-at-advanced-cluster-management">A first look at Advanced Cluster Management</h2>
<p>Now let&rsquo;s change to the full ACM console:</p>
<ul>
<li>Switch back to the <code>local-clusters</code> view</li>
<li>Go to <strong>Operators</strong>-&gt;<strong>Installed operators</strong> and click the <strong>Advanced Cluster Management for Kubernetes</strong> operator</li>
<li>In the operator overview page choose the <strong>MultiClusterHub</strong> tab.</li>
<li>The <code>multiclusterhub</code> instance you deployed should be in <strong>Status</strong> <code>Running</code> by now.</li>
<li>Look up the route for the <code>multicloud-console</code> and access it.</li>
<li>Click the <strong>Log in with OpenShift</strong> button and login with your OpenShift account.</li>
</ul>
<p>You are now in your ACM dashboard!</p>
<figure>
    <img src="../images/acm-dashboard.png?width=70pc&amp;classes=border,shadow"/> <figcaption>
            <h4>Click image to enlarge</h4>
        </figcaption>
</figure>

<p>Have a look around:</p>
<ul>
<li>Go to <strong>Infrastructure</strong>-&gt;<strong>Clusters</strong></li>
<li>You&rsquo;ll see your lab OpenShift cluster here, the infrastructure it&rsquo;s running on and the version.
<ul>
<li>There might be a version update available, don&rsquo;t run it please&hellip; ;)</li>
</ul>
</li>
<li>If you click the cluster name, you&rsquo;ll get even more information, explore!</li>
</ul>
<h2 id="manage-cluster-lifecycle">Manage Cluster Lifecycle</h2>
<p>One of the main features of Advanced Cluster Management is cluster lifecycle management. ACM can help to:</p>
<ul>
<li>manage credentials</li>
<li>deploy clusters to different cloud providers and on-premise</li>
<li>import existing clusters</li>
<li>use labels on clusters for management purposes</li>
</ul>
<p>Let&rsquo;s give this a try!</p>
<h2 id="deploy-an-openshift-cluster">Deploy an OpenShift Cluster</h2>
<p>Okay, to not overstress our cloud ressources and for the fun of it we&rsquo;ll deploy a Single Node OpenShift to the same AWS account your lab cluster is running in.</p>
<h3 id="create-cloud-credentials">Create Cloud Credentials</h3>
<p>The first step is to create credentials in ACM to deploy to the Amazon Web Services account.</p>

<div class="notices tip" ><p>You&rsquo;ll get the <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> needed to deploy to AWS from your facilitators.</p>
</div>

<ul>
<li>On your OpenShift cluster, create a new namespace <code>sno</code></li>
<li>In the ACM web console, navigate to <strong>Credentials</strong> and click <strong>Add credential</strong>:
<ul>
<li>As <strong>Credential type</strong> select <code>AWS</code></li>
<li><strong>Credential name</strong>: sno</li>
<li><strong>Namespace</strong>: Choose the <code>sno</code> namespace</li>
<li><strong>Base DNS domain</strong>: <code>sandbox&lt;NNNN&gt;.opentlc.com</code>, replace <code>&lt;NNNN&gt;</code> with your id, you can find it e.g. in the URL</li>
<li>Click <strong>Next</strong></li>
<li>Now you need to enter the AWS credentials, enter the <code>Access key ID</code> and <code>Secret access key</code> as provided.</li>
<li>Click <strong>Next</strong></li>
<li>Click <strong>Next</strong> again for proxy settings</li>
<li>Now you need to enter an OpenShift Pull Secret, copy it from your OCP cluster:
<ul>
<li>Switch to the project <code>openshift-config</code> and copy the content of the secret <code>pull-secret</code></li>
</ul>
</li>
<li>To connect to the managed SNO you need to enter a SSH private key (<code>$HOME/.ssh/&lt;LABID&gt;key.pem</code>) and public key (<code>$HOME/.ssh/&lt;LABID&gt;key.pub</code>).
<ul>
<li>Use the respective keys from your lab environments bastion host, the access details will be provided.</li>
<li>The <code>&lt;LABID&gt;</code> can be found in the URL, e.g. multicloud-console.apps.cluster-<strong>z48z9</strong>.z48z9.sandbox910.opentlc.com</li>
</ul>
</li>
<li>Click <strong>Next</strong></li>
<li>Click <strong>Add</strong></li>
</ul>
</li>
</ul>
<p>You have created a new set of credentials to deploy to the AWS account you are using.</p>
<h2 id="deploy-single-node-openshift">Deploy Single Node OpenShift</h2>
<p>Now you&rsquo;ll deploy a new OpenShift instance:</p>
<ul>
<li>In the ACM console, navigate to <strong>Infrastructure</strong> -&gt; <strong>Clusters</strong> and click <strong>Create cluster</strong>.</li>
<li>As provider choose <strong>Amazon Web Services</strong></li>
<li><strong>Infrastructure provider credential</strong>: Select the <code>sno</code> credential you created.</li>
<li><strong>Cluster name</strong>: aws-sno</li>
<li><strong>Cluster set</strong>: Leave empty &hellip;</li>
<li><strong>Base DNS Domain</strong>: Set automatically from the credentials</li>
<li><strong>Release name</strong>: Use the latest <strong>4.10</strong> release available</li>
<li><strong>Additional Label</strong>: sno=true</li>
<li>Click <strong>Next</strong></li>
<li>On the Node pools view leave the <strong>Region</strong> set to <code>us-east-1</code></li>
<li><strong>Architecture</strong>: amd64</li>
<li>Expand <strong>Control plane pool</strong>
<ul>
<li>read the information for <strong>Zones</strong> (and leave the setting empty)</li>
<li>change <strong>Instance Type</strong> to <code>m5.2xlarge</code>.</li>
</ul>
</li>
<li>Expand <strong>Worker pool 1</strong>:
<ul>
<li>Set <strong>Node count</strong> to <code>0</code> (we want a single node OCP&hellip;).</li>
</ul>
</li>
<li>Click <strong>Next</strong></li>
<li>Have a look at the network screen but don&rsquo;t change anything</li>
</ul>
<p>Now click <strong>Next</strong> until you arrive at the <strong>Review</strong>. Do the following:</p>
<ul>
<li>Set <code>YAML: On</code></li>
<li>In the <strong>cluster YAML</strong> editor select the <strong>install-config</strong> tab</li>
<li>In the <code>controlPlane</code> section change the <code>replicas</code> field to <code>1</code>.</li>
</ul>
<p>It&rsquo;s time to deploy your cluster, click <strong>Create</strong>!</p>
<p>ACM monitors the installation of the new cluster and finally imports it. Click <strong>View logs</strong> under <strong>Cluster install</strong> to follow the installation log.</p>

<div class="notices tip" ><p>Installation of a SNO take around 30 minutes in our lab environment.</p>
</div>

<p>After installation has finished, access the <strong>Clusters</strong> section in the ACM portal again.</p>
<figure>
    <img src="../images/acm-clusters.png?width=70pc&amp;classes=border,shadow"/> <figcaption>
            <h4>Click image to enlarge</h4>
        </figcaption>
</figure>

<p>Explore the information ACM is providing, including the Console URL and the access credentials of your shiny new SNO instance. Use them to login to the SNO console.</p>
<h2 id="application-lifecycle-management">Application Lifecycle Management</h2>
<p>In the previous lab, you explored the Cluster Lifecycle functionality of RHACM by deploying a new OpenShift single-node instance to AWS. Now let&rsquo;s have a look at another capability, Application Lifecycle management.</p>
<p>Application Lifecycle management is used to manage applications on your clusters. This allows you to define a single or multi-cluster application using Kubernetes specifications, but with additional automation of the deployment and lifecycle management of resources to individual clusters. An application designed to run on a single cluster is straightforward and something you ought to be familiar with from working with OpenShift fundamentals. A multi-cluster application allows you to orchestrate the deployment of these same resources to multiple clusters, based on a set of rules you define for which clusters run the application components.</p>
<p>The naming of the different components of the Application Lifecycle model in RHACM is as follows:</p>
<ul>
<li><strong>Channel</strong>: Defines a place where deployable resources are stored, such as an object store, Kubernetes namespace, Helm repository, or GitHub repository.</li>
<li><strong>Subscription</strong>: Definitions that identify deployable resources available in a Channel resource that are to be deployed to a target cluster.</li>
<li><strong>PlacementRule</strong>: Defines the target clusters where subscriptions deploy and maintain the application. It is composed of Kubernetes resources identified by the Subscription resource and pulled from the location defined in the Channel resource.</li>
<li><strong>Application</strong>: A way to group the components here into a more easily viewable single resource. An Application resource typically references a Subscription resource.</li>
</ul>
<h2 id="creating-a-simple-application-with-acm">Creating a Simple Application with ACM</h2>
<p>Start with adding labels to your two OpenShift clusters in your ACM console:</p>
<ul>
<li>On the local cluster add a label: <code>environment=prod</code></li>
<li>On the new SNO deployment add label: <code>environment=dev</code></li>
</ul>
<figure>
    <img src="../images/acm-application1.png?width=60pc&amp;classes=border,shadow"/> <figcaption>
            <h4>Click image to enlarge</h4>
        </figcaption>
</figure>

<p>Now it&rsquo;s time to actually deploy the application. But first have a look at the manifest definitions ACM will use as deployables at <a href="https://github.com/devsecops-workshop/book-import/tree/master/book-import">https://github.com/devsecops-workshop/book-import/tree/master/book-import</a>.</p>
<p>Then in the ACM console navigate to <strong>Applications</strong>:</p>
<ul>
<li>Click <strong>Create application</strong>, select <strong>Subscription</strong></li>
<li>Make sure the view is set to YAML</li>
<li><strong>Name</strong>: book-import</li>
<li><strong>Namespace</strong>: book-import</li>
<li>Under <strong>Repository location for resources</strong> -&gt; <strong>Repository types</strong>, select <code>GIT</code></li>
<li><strong>URL</strong>: <a href="https://github.com/devsecops-workshop/book-import.git">https://github.com/devsecops-workshop/book-import.git</a></li>
<li><strong>Branch</strong>: master</li>
<li><strong>Path</strong>: book-import</li>
<li>Select <strong>Deploy application resources only on clusters matching specified labels</strong></li>
<li><strong>Label</strong>: environment</li>
<li><strong>Value</strong>: dev</li>
</ul>
<figure>
    <img src="../images/acm-application2.png?width=20pc&amp;classes=border,shadow"/> <figcaption>
            <h4>Click image to enlarge</h4>
        </figcaption>
</figure>

<p>Click <strong>Create</strong>, after a few minutes you will see the application available in ACM. Click the application and have a look at the topology view:</p>
<figure>
    <img src="../images/acm-application3.png?width=20pc&amp;classes=border,shadow"/> <figcaption>
            <h4>Click image to enlarge</h4>
        </figcaption>
</figure>

<ul>
<li>Select <strong>Cluster</strong>, the application should have been deployed to the SNO cluster because of the label <code>environment=dev</code></li>
<li>Select the <strong>Route</strong> and click on the URL, this should take you to the Book Import application</li>
<li>Explore the other objects</li>
</ul>
<p>Now edit the application in the ACM console and change the label to <code>environment=prod</code>. What happens?</p>
<p>In this simple example you have seen how to deploy an application to an OpenShift cluster using ACM. All manifests defining the application where kept in a Git repo, ACM then used the manifests to deploy the required objects into the target cluster.</p>
<h2 id="prepost-tasks-with-ansible-automation-platform-2">Pre/Post Tasks with Ansible Automation Platform 2</h2>
<p>You can integrate Ansible Automation Platform and the Automation Controller (formerly known as Ansible Tower) with ACM to perform pre / post tasks within the application lifecycle engine. The prehook and posthook task allows you to trigger an Ansible playbook before and after the application is deployed, respectively.</p>
<h3 id="install-automation-controller">Install Automation Controller</h3>
<p>To give this a try you need an Automation Controller instance. So let&rsquo;s deploy one on your cluster using the AAP Operator:</p>
<ul>
<li>In OperatorHub search for the <code>Ansible Automation Platform</code> operator and install it using the default settings.</li>
<li>After installation has finished create an Automation Controller instance using the Operator, name it <code>automationcontroller</code></li>
<li>When the instance is ready, look up <code>automationcontroller-admin-password</code> secret</li>
<li>Then look up the <code>automationcontroller</code> route, access it and login as user <code>admin</code> using the password from the secret</li>
<li>Apply a manifest or use the username/password login to the Red Hat Customer Portal and add a subscription</li>
</ul>
<p>You are now set with a shiny new Ansible Automation Platform Controller!</p>
<h3 id="add-auth-token">Add Auth Token</h3>
<p>In the Automation Controller web UI, generate a token for the admin user:</p>
<ul>
<li>Go to <strong>Users</strong></li>
<li>Click <code>admin</code> and select <strong>Tokens</strong></li>
<li>Click the <strong>Add</strong> button</li>
<li>As description add <code>Token for use by ACM</code></li>
<li>Update the <strong>Scope</strong> to <code>Write</code></li>
<li>Click <strong>Save</strong></li>
</ul>
<p>Save the token value to a text file, you will need this token later!</p>
<h3 id="configure-template-in-automation-controller">Configure Template in Automation Controller</h3>
<p>For Automation Controller to run something we must configure a Project and a Template first.</p>
<p>Create an Ansible Project:</p>
<ul>
<li>Select <strong>Projects</strong> in the left menu</li>
<li>Click <strong>Add</strong></li>
<li><strong>Name</strong>: ACM Test</li>
<li><strong>Organization</strong>: Default</li>
<li><strong>SCM Type</strong>: Git</li>
<li><strong>SCM URL</strong>: <a href="https://github.com/devsecops-workshop/ansible-acm.git">https://github.com/devsecops-workshop/ansible-acm.git</a></li>
<li>Click <strong>Save</strong></li>
</ul>
<p>Create an Ansible Job Template:</p>
<ul>
<li>Select <strong>Templates</strong> in the left menu.</li>
<li>Click <strong>Add</strong> then <strong>Add Job Template</strong></li>
<li><strong>Name</strong>: acm-test</li>
<li><strong>Inventory</strong>: Demo Inventory</li>
<li><strong>Project</strong>: ACM Test</li>
<li><strong>Playbook</strong>: message.yml</li>
<li>Check <strong>Prompt on launch</strong> for <strong>Variables</strong></li>
<li>Click <strong>Save</strong></li>
<li>Click <strong>Launch</strong></li>
</ul>
<p>Verify that the Job run by going to <strong>Jobs</strong> and looking for an <code>acm-test</code> job showing a successful Playbook run.</p>
<h3 id="create-aap-credentials-in-acm">Create AAP credentials in ACM</h3>
<p>Set up the credential which is going to allow ACM to interact with your AAP instance in your ACM Portal:</p>
<ul>
<li>Click on <strong>Credentials</strong> on the left menu and select <strong>Add Credential</strong> button.</li>
<li><strong>Credential type</strong>: Red Hat Ansible Automation Platform</li>
<li><strong>Credential name</strong>: appaccess</li>
<li><strong>Namespace</strong>: open-cluster-management</li>
<li>Click <strong>Next</strong></li>
<li><strong>Ansible Tower Host</strong>: <Automation Controller instance URL></li>
<li><strong>Ansible Tower token</strong>: <admin user token you generated earlier></li>
<li>Click <strong>Next</strong> and <strong>Add</strong></li>
</ul>
<h3 id="use-the-acm---ansible-integration">Use the ACM - Ansible integration</h3>
<p>And now let&rsquo;s configure the ACM integration with Ansible Automation Platform to kick off a job in Automation Controller. In this case the Ansible job will just run our simple playbook that will only output a message.</p>
<p>In the ACM Portal:</p>
<ul>
<li>Go to the <strong>Applications</strong> menu on the left and click <strong>Create application â Subscription</strong></li>
<li>Enter the following information:
<ul>
<li><strong>Name</strong>: book-import2</li>
<li><strong>Namespace</strong>: book-import2</li>
</ul>
</li>
<li>Under <strong>repository types</strong>, select <strong>GIT repository</strong></li>
<li><strong>URL</strong>: <a href="https://github.com/devsecops-workshop/book-import.git">https://github.com/devsecops-workshop/book-import.git</a></li>
<li><strong>Branch</strong>: prehook</li>
<li><strong>Path</strong>: book-import</li>
<li>Expand the <strong>Configure automation for prehook and posthook</strong> dropdown menu</li>
<li><strong>Ansible Automation Platform credential</strong>: appaccess</li>
<li>Select <strong>Deploy application resources only on clusters matching specified labels</strong></li>
<li><strong>Label</strong>: environment</li>
<li><strong>Value</strong>: dev</li>
<li>Click <strong>Create</strong></li>
</ul>
<p>Give this a few minutes. The application will complete and in the application topology view you will see the Ansible prehook. In Automation Controller go to <strong>Jobs</strong> and verify the Automation Job run.</p>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="https://devsecops-workshop.github.io/15-runtime-security/" title="Securing Runtime Events"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://devsecops-workshop.github.io/20-appendix/" title="Appendix" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://devsecops-workshop.github.io/js/clipboard.min.js?1712332138"></script>
    <script src="https://devsecops-workshop.github.io/js/perfect-scrollbar.min.js?1712332138"></script>
    <script src="https://devsecops-workshop.github.io/js/perfect-scrollbar.jquery.min.js?1712332138"></script>
    <script src="https://devsecops-workshop.github.io/js/jquery.sticky.js?1712332138"></script>
    <script src="https://devsecops-workshop.github.io/js/featherlight.min.js?1712332138"></script>
    <script src="https://devsecops-workshop.github.io/js/highlight.pack.js?1712332138"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://devsecops-workshop.github.io/js/modernizr.custom-3.6.0.js?1712332138"></script>
    <script src="https://devsecops-workshop.github.io/js/learn.js?1712332138"></script>
    <script src="https://devsecops-workshop.github.io/js/hugo-learn.js?1712332138"></script>
    
        
            <script src="https://devsecops-workshop.github.io/mermaid/mermaid.js?1712332138"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
