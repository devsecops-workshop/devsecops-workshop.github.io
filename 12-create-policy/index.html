<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.0" />
    <meta name="description" content="A DevSecOps Workshop Day using openShift and ACS">
<meta name="author" content="GÃ¶tz, Daniel">

    <link rel="icon" href="https://devsecops-workshop.github.io/images/favicon.png" type="image/png">

    <title>Create a Custom Security Policy :: DevSecOps Workshop 2021</title>

    
    <link href="https://devsecops-workshop.github.io/css/nucleus.css?1634905813" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/fontawesome-all.min.css?1634905813" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/hybrid.css?1634905813" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/featherlight.min.css?1634905813" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/perfect-scrollbar.min.css?1634905813" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/auto-complete.css?1634905813" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/atom-one-dark-reasonable.css?1634905813" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/theme.css?1634905813" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/tabs.css?1634905813" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/hugo-theme.css?1634905813" rel="stylesheet">
    
    <link href="https://devsecops-workshop.github.io/css/theme-red.css?1634905813" rel="stylesheet">
    
    

    <script src="https://devsecops-workshop.github.io/js/jquery-3.3.1.min.js?1634905813"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/12-create-policy/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://devsecops-workshop.github.io/">
    <img src="https://devsecops-workshop.github.io/images/acs-logo.png">
  </a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://devsecops-workshop.github.io/js/lunr.min.js?1634905813"></script>
<script type="text/javascript" src="https://devsecops-workshop.github.io/js/auto-complete.js?1634905813"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/devsecops-workshop.github.io\/";
    
</script>
<script type="text/javascript" src="https://devsecops-workshop.github.io/js/search.js?1634905813"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='https://devsecops-workshop.github.io/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-intro/" title="The DevSecOps Workshop" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/1-intro/">
          The DevSecOps Workshop
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-prepare-cluster/" title="Prepare Cluster" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/2-prepare-cluster/">
          Prepare Cluster
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-inner-loop/" title="Inner Loop" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/3-inner-loop/">
          Inner Loop
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-outer-loop/" title="Outer Loop" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/4-outer-loop/">
          Outer Loop
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-gitops/" title="Configure GitOps" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/5-gitops/">
          Configure GitOps
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/10-rhacs-setup/" title="Install and Configure ACS" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/10-rhacs-setup/">
          Install and Configure ACS
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/11-rhacs-warmup/" title="Getting to know ACS" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/11-rhacs-warmup/">
          Getting to know ACS
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/12-create-policy/" title="Create a Custom Security Policy" class="dd-item
        
        active
        
        ">
      <a href="https://devsecops-workshop.github.io/12-create-policy/">
          Create a Custom Security Policy
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/13-rhacs-pipeline/" title="Integrating ACS into the Pipeline" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/13-rhacs-pipeline/">
          Integrating ACS into the Pipeline
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/14-runtime-security/" title="Securing Runtime Events" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/14-runtime-security/">
          Securing Runtime Events
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/100-playground/" title="Playground" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/100-playground/">
          Playground
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://devsecops-workshop.github.io/"><i class='fas fa-home'></i> Homepage</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='https://devsecops-workshop.github.io/'></a> > Create a Custom Security Policy
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#objective">Objective</a></li>
    <li><a href="#create-a-custom-system-policy">Create a Custom System Policy</a></li>
    <li><a href="#test-the-policy">Test the Policy</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Create a Custom Security Policy
            </h1>
          

        



	<h2 id="objective">Objective</h2>
<p>You should by now have one or more pipelines to build your application, now we want to secure the build and deployment of it. For the sake of this workshop we&rsquo;ll take a somewhat simplified use case:</p>
<p><strong>We want to scan our application image for the Red Hat Security Advisory RHSA-2020:5566 concerning openssl-lib.</strong></p>
<p>If this RHSA is found in an image we don&rsquo;t want to deploy the application using it.</p>
<p>These are the steps you will go through:</p>
<ul>
<li>Create a custom <strong>Security Policy</strong> to check for the advisory</li>
<li>Test if the policy is triggered in non-enforcing mode
<ul>
<li>with an older image version that contains the advisory</li>
<li>and then with a newer versiowhere the issue has been fixed.</li>
</ul>
</li>
<li>The final goal is to integrate the policy into the build pipeline</li>
</ul>
<h2 id="create-a-custom-system-policy">Create a Custom System Policy</h2>
<p>First create the system policy. In the <strong>ACS Portal</strong> do the following:</p>
<ul>
<li><strong>System Policies-&gt;Create Policy</strong></li>
<li><strong>NAME:</strong> Deepspace RHSA-2020:5566</li>
<li><strong>Severity:</strong> Critical</li>
<li><strong>Lifecycle Stages:</strong> Build, Deploy</li>
<li><strong>Categories:</strong> Deepspace
<ul>
<li>This will create a new Category if it doesn&rsquo;t exist</li>
</ul>
</li>
<li><strong>-&gt;Next</strong></li>
<li>Click <strong>Add a new condition</strong></li>
<li>Find the policy field <strong>CVE</strong> in <strong>Image Contents</strong> and drag-and-drop it into the <strong>Drop A Policy Field Inside</strong> area.</li>
<li>Put <code>RHSA-2020:5566</code> into the <strong>CVE</strong> field</li>
<li>Click <strong>-&gt;Next</strong></li>
<li>The next page will show <strong>Deployments</strong> that would generate violations</li>
<li>Click <strong>-&gt;Next</strong></li>
<li>On the next page you could enable enforcement of the policy for the <strong>Build</strong> and/or <strong>Deploy</strong> stages. <strong>Don&rsquo;t enable enforcement yet!</strong></li>
<li>Click <strong>Save</strong></li>
</ul>
<h2 id="test-the-policy">Test the Policy</h2>
<p>Start the pipeline with the affected image version:</p>
<ul>
<li>Go to the Pipeline, Start it and set <strong>Version</strong> to <code>java-old-test</code></li>
<li>Follow the <strong>Violations</strong> in the <strong>ACS Portal</strong></li>
<li>Expected result:
<ul>
<li>You&rsquo;ll see the build deployments (<code>Quarkus-Build-Options-Git-Gsklhg-Build-...</code>) come and go when they are finished.</li>
<li>When the final build is deployed you&rsquo;ll see a violation in <strong>ACS Portal</strong> for policy <code>Deepspace RHSA-2020:5566</code> (Check the Time of the violation)</li>
</ul>
</li>
</ul>
<p>Now start the pipeline with the fixed image version that doesn&rsquo;t contain the CVE anymore:</p>
<ul>
<li>Start the pipeline again but this time leave the Java <strong>Version</strong> as is.</li>
<li>Follow the <strong>Violations</strong> in the <strong>ACS Portal</strong></li>
<li>Expected result:
<ul>
<li>You&rsquo;ll see the build deployments come up and go</li>
<li>When the final build is deployed you&rsquo;ll see the policy violation in <strong>ACS Portal</strong> from before is gone because the image no longer contains it.</li>
</ul>
</li>
</ul>
<p>This shows how ACS is automatically scanning images when they become active against all enabled policies. But we don&rsquo;t want to just see a violation after the image has been deployed, we want to disable the deployment during build time! So the next step is to integrate the check into the build pipeline and enforce it (don&rsquo;t deploy the application).</p>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="https://devsecops-workshop.github.io/11-rhacs-warmup/" title="Getting to know ACS"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://devsecops-workshop.github.io/13-rhacs-pipeline/" title="Integrating ACS into the Pipeline" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://devsecops-workshop.github.io/js/clipboard.min.js?1634905813"></script>
    <script src="https://devsecops-workshop.github.io/js/perfect-scrollbar.min.js?1634905813"></script>
    <script src="https://devsecops-workshop.github.io/js/perfect-scrollbar.jquery.min.js?1634905813"></script>
    <script src="https://devsecops-workshop.github.io/js/jquery.sticky.js?1634905813"></script>
    <script src="https://devsecops-workshop.github.io/js/featherlight.min.js?1634905813"></script>
    <script src="https://devsecops-workshop.github.io/js/highlight.pack.js?1634905813"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://devsecops-workshop.github.io/js/modernizr.custom-3.6.0.js?1634905813"></script>
    <script src="https://devsecops-workshop.github.io/js/learn.js?1634905813"></script>
    <script src="https://devsecops-workshop.github.io/js/hugo-learn.js?1634905813"></script>
    
        
            <script src="https://devsecops-workshop.github.io/mermaid/mermaid.js?1634905813"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
