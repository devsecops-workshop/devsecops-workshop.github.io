<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.0" />
    <meta name="description" content="A DevSecOps Workshop Day using openShift and ACS">
<meta name="author" content="GÃ¶tz, Daniel">

    <link rel="icon" href="https://devsecops-workshop.github.io/images/favicon.png" type="image/png">

    <title>Prepare Cluster :: DevSecOps Workshop</title>

    
    <link href="https://devsecops-workshop.github.io/css/nucleus.css?1686146575" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/fontawesome-all.min.css?1686146575" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/hybrid.css?1686146575" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/featherlight.min.css?1686146575" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/perfect-scrollbar.min.css?1686146575" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/auto-complete.css?1686146575" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/atom-one-dark-reasonable.css?1686146575" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/theme.css?1686146575" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/tabs.css?1686146575" rel="stylesheet">
    <link href="https://devsecops-workshop.github.io/css/hugo-theme.css?1686146575" rel="stylesheet">
    
    <link href="https://devsecops-workshop.github.io/css/theme-red.css?1686146575" rel="stylesheet">
    
    

    <script src="https://devsecops-workshop.github.io/js/jquery-3.3.1.min.js?1686146575"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
<script src="https://devsecops-workshop.github.io/js/custom.js"></script>
  </head>
  <body class="" data-url="/2-prepare-cluster/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://devsecops-workshop.github.io/">
    <img src="https://devsecops-workshop.github.io/images/acs-logo.png">
  </a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://devsecops-workshop.github.io/js/lunr.min.js?1686146575"></script>
<script type="text/javascript" src="https://devsecops-workshop.github.io/js/auto-complete.js?1686146575"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/devsecops-workshop.github.io\/";
    
</script>
<script type="text/javascript" src="https://devsecops-workshop.github.io/js/search.js?1686146575"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='https://devsecops-workshop.github.io/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-intro/" title="The DevSecOps Workshop" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/1-intro/">
          The DevSecOps Workshop
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-prepare-cluster/" title="Prepare Cluster" class="dd-item
        
        active
        
        ">
      <a href="https://devsecops-workshop.github.io/2-prepare-cluster/">
          Prepare Cluster
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-inner-loop/" title="Inner Loop" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/3-inner-loop/">
          Inner Loop
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-outer-loop/" title="Outer Loop" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/4-outer-loop/">
          Outer Loop
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-gitops/" title="Configure GitOps" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/5-gitops/">
          Configure GitOps
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/10-rhacs-setup/" title="Install and Configure ACS" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/10-rhacs-setup/">
          Install and Configure ACS
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/11-rhacs-warmup/" title="Getting to know ACS" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/11-rhacs-warmup/">
          Getting to know ACS
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/12-create-policy/" title="Create a Custom Security Policy" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/12-create-policy/">
          Create a Custom Security Policy
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/13-rhacs-pipeline/" title="Integrating ACS into the Pipeline" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/13-rhacs-pipeline/">
          Integrating ACS into the Pipeline
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/15-runtime-security/" title="Securing Runtime Events" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/15-runtime-security/">
          Securing Runtime Events
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/16-acm/" title="Advanced Cluster Management" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/16-acm/">
          Advanced Cluster Management
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/20-appendix/" title="Appendix" class="dd-item
        
        
        
        ">
      <a href="https://devsecops-workshop.github.io/20-appendix/">
          Appendix
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://devsecops-workshop.github.io/"><i class='fas fa-home'></i> Homepage</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='https://devsecops-workshop.github.io/'></a> > Prepare Cluster
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#cluster-preparation">Cluster Preparation</a></li>
    <li><a href="#install-openshift-data-foundation">Install OpenShift Data Foundation</a></li>
    <li><a href="#install-and-prepare-gitea">Install and Prepare Gitea</a></li>
    <li><a href="#check-openshift-data-foundation-odf-storage-deployment">Check OpenShift Data Foundation (ODF) Storage Deployment</a></li>
    <li><a href="#architecture-recap">Architecture recap</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Prepare Cluster
            </h1>
          

        



	<h2 id="cluster-preparation">Cluster Preparation</h2>
<p>During this workshop you&rsquo;ll install and use a good number of software components. The first one is <code>OpenShift Data Foundation</code> for providing storage. We&rsquo;ll start with it because the install takes a fair amount of time. Number two is <code>Gitea</code> for providing Git services in your cluster with more to follow in subsequent chapters.</p>
<p>But fear not, all are managed by Kubernetes <a href="https://cloud.redhat.com/learn/topics/operators">Operators</a> on OpenShift.</p>
<h2 id="install-openshift-data-foundation">Install OpenShift Data Foundation</h2>
<p>Let&rsquo;s install <a href="https://www.redhat.com/en/technologies/cloud-computing/openshift-data-foundation">OpenShift Data Foundation</a> which you might know under the old name <code>OpenShift Container Storage</code>. It is engineered as the data and storage services platform for OpenShift and provides software-defined storage for containers.</p>
<ul>
<li>Login to the OpenShift Webconsole with you cluster admin credentials</li>
<li>In the Web Console, go to <strong>Operators &gt; OperatorHub</strong> and search for the <code>OpenShift Data Foundation</code> operator
<figure>
    <img src="../images/odf-operator.png?width=50pc&amp;classes=border,shadow"/> <figcaption>
            <h4>Click image to enlarge</h4>
        </figcaption>
</figure>
</li>
<li>Install the operator with default settings</li>
</ul>
<p>After the operator has been installed it will inform you to install a <code>StorageSystem</code>. From the operator overview page click <code>Create StorageSystem</code> with the following settings:</p>
<ul>
<li><strong>Backing storage</strong>: Leave <code>Deployment Type</code> <code>Full deployment</code> and for <code>Backing storage type</code> make sure <code>gp2</code> is selected.</li>
<li>Click <strong>Next</strong></li>
<li><strong>Capacity and nodes</strong>: Leave the <code>Requested capacity</code> as is (2 TiB) and select all nodes.</li>
<li>Click <strong>Next</strong></li>
<li><strong>Security and network</strong>: Leave set to <code>Default (SDN)</code></li>
<li>Click <strong>Next</strong></li>
</ul>
<p>You&rsquo;ll see a review of your settings, hit <code>Create StorageSystem</code></p>

<div class="notices tip" ><p>Don&rsquo;t worry if you see a <em>404 Page</em>. The ODF Operator has just extended the OpenShift Console which may no be availabe in your current view. Just relead the browser page once and your will see the System Overview</p>
</div>

<figure>
    <img src="../images/odf-systems.png?width=50pc&amp;classes=border,shadow"/> <figcaption>
            <h4>Click image to enlarge</h4>
        </figcaption>
</figure>

<p>As mentioned already this takes some time so go ahead and install the other prerequisites. We&rsquo;ll come back later.</p>
<h2 id="install-and-prepare-gitea">Install and Prepare Gitea</h2>
<p>We&rsquo;ll need Git repository services to keep our app and infrastructure source code, so let&rsquo;s just install trusted <code>Gitea</code> using an operator:</p>

<div class="notices tip" ><p><a href="https://gitea.io/en-us/">Gitea</a> is an OpenSource Git Server similar to GitHub. A team at Red Hat was so nice to create an Operator for it. This is a good example of how you can integrate an operator into your catalog that is not part of the default <a href="https://operatorhub.io/">OperatorHub</a> already.</p>
</div>

<p>To integrate the <code>Gitea</code> operator into your Operator catalog you need to access your cluster with the <code>oc</code> client. You can do this in two ways:</p>
<ul>
<li>If you don&rsquo;t already have the oc client installed, you can download the matching version for your operating system <a href="https://mirror.openshift.com/pub/openshift-v4/clients/ocp/stable/">here</a></li>
<li>Login to the OpenShift Webconsole with you cluster admin credentials</li>
<li>On the top right click on your username and then <strong>Copy login command</strong> to copy your login token</li>
<li>On you local machine open a terminal and login with the <code>oc</code> command you copied above</li>
</ul>
<p>Or, if working on a Red Hat RHPDS environment:</p>
<ul>
<li>Use the information provided to login to your bastion host via SSH</li>
<li>When logged in as <code>lab-user</code> you will be able to run <code>oc</code> commands without additional login.</li>
</ul>
<p>Now using <code>oc</code> add the Gitea Operator to your OpenShift OperatorHub catalog:</p>
<pre><code>oc apply -f https://raw.githubusercontent.com/redhat-gpte-devopsautomation/gitea-operator/master/catalog_source.yaml
</code></pre><ul>
<li>In the Web Console, go to <strong>Operators &gt; OperatorHub</strong> and search for <code>Gitea</code> (You may need to disable search filters)</li>
<li>Install the <code>Gitea Operator</code> with default settings</li>
<li>Create a new OpenShift project called <code>git</code></li>
<li>Go to <strong>Installed Operators &gt; Gitea Operator</strong> and click on the <strong>Create Instance</strong> tile in the <code>git</code> project</li>
</ul>
<!-- ![Gitea](../images/gitea.png) -->
<figure>
    <img src="../images/gitea.png?width=50pc&amp;classes=border,shadow"/> <figcaption>
            <h4>Click image to enlarge</h4>
        </figcaption>
</figure>

<ul>
<li>On the <strong>Create Gitea</strong> page switch to the YAML view and add the following <code>spec</code> values :</li>
</ul>
<pre><code>spec:
  giteaAdminUser: gitea
  giteaAdminPassword: &quot;gitea&quot;
  giteaAdminEmail: opentlc-mgr@redhat.com
</code></pre><ul>
<li>Click <strong>Create</strong></li>
</ul>
<p>After creation has finished:</p>
<ul>
<li>Access the route URL (you&rsquo;ll find it e.g. in <strong>Networking &gt; Routes &gt; repository &gt; Location</strong>)</li>
<li>This will take you to the Gitea web UI</li>
<li>Sign-In to <code>Gitea</code> with user <code>gitea</code> and password <code>gitea</code></li>
<li>If your Gitea UI appears in a language other then English (depending on your locale settings), switch it to English. Change the language in your Gitea UI, the example below shows a German example:</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><figure>
    <img src="../images/gitea-lang1.png?width=10pc&amp;classes=border,shadow"/> <figcaption>
            <h4>Click image to enlarge</h4>
        </figcaption>
</figure>
</td>
<td><figure>
    <img src="../images/gitea-lang2.png?width=10pc&amp;classes=border,shadow"/> <figcaption>
            <h4>Click image to enlarge</h4>
        </figcaption>
</figure>
</td>
</tr>
</tbody>
</table>
<p>Now we will clone a git repository of a sample application into our Gitea, so we have some code to works with</p>
<ul>
<li>Clone the example repo:
<ul>
<li>Click the <strong>+</strong> dropdown and choose <strong>New Migration</strong></li>
<li>As type choose <strong>Git</strong></li>
<li><strong>URL</strong>: <a href="https://github.com/devsecops-workshop/quarkus-build-options.git">https://github.com/devsecops-workshop/quarkus-build-options.git</a></li>
<li>Click <strong>Migrate Repository</strong></li>
</ul>
</li>
</ul>
<p>In the cloned repository you&rsquo;ll find a <code>devspaces_devfile.yml</code>. We will need the URL to the file soon, so keep the tab open.</p>
<h2 id="check-openshift-data-foundation-odf-storage-deployment">Check OpenShift Data Foundation (ODF) Storage Deployment</h2>
<p>Now it&rsquo;s time to check if the <code>StorageSystem</code> deployment from ODF completed succesfully. In the openShift web console:</p>
<ul>
<li>Open <strong>Storage-&gt;DataFoundation</strong></li>
<li>On the overview page go to the <strong>Storage Systems</strong> tab</li>
<li>Click <strong>ocs-storagecluster-storagesystem</strong></li>
<li>On the next page make sure the status indicators on the <strong>Block and File</strong> and <strong>Object</strong> tabs are <strong>green</strong>!</li>
</ul>
<figure>
    <img src="../images/storage-system1.png?width=40pc&amp;classes=border,shadow"/> <figcaption>
            <h4>Click image to enlarge</h4>
        </figcaption>
</figure>

<figure>
    <img src="../images/storage-system2.png?width=45pc&amp;classes=border,shadow"/> <figcaption>
            <h4>Click image to enlarge</h4>
        </figcaption>
</figure>

<p>Your container storage is ready to go, explore the information on the overview pages if you&rsquo;d like.</p>
<p>Your cluster is now prepared for the next step, proceed to the <strong>Inner Loop</strong>.</p>
<h2 id="architecture-recap">Architecture recap</h2>
<figure>
    <img src="../images/workshop_architecture_prepare.png?width=50pc&amp;classes=border,shadow"/> <figcaption>
            <h4>Click image to enlarge</h4>
        </figcaption>
</figure>






<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="https://devsecops-workshop.github.io/1-intro/" title="The DevSecOps Workshop"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://devsecops-workshop.github.io/3-inner-loop/" title="Inner Loop" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://devsecops-workshop.github.io/js/clipboard.min.js?1686146575"></script>
    <script src="https://devsecops-workshop.github.io/js/perfect-scrollbar.min.js?1686146575"></script>
    <script src="https://devsecops-workshop.github.io/js/perfect-scrollbar.jquery.min.js?1686146575"></script>
    <script src="https://devsecops-workshop.github.io/js/jquery.sticky.js?1686146575"></script>
    <script src="https://devsecops-workshop.github.io/js/featherlight.min.js?1686146575"></script>
    <script src="https://devsecops-workshop.github.io/js/highlight.pack.js?1686146575"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://devsecops-workshop.github.io/js/modernizr.custom-3.6.0.js?1686146575"></script>
    <script src="https://devsecops-workshop.github.io/js/learn.js?1686146575"></script>
    <script src="https://devsecops-workshop.github.io/js/hugo-learn.js?1686146575"></script>
    
        
            <script src="https://devsecops-workshop.github.io/mermaid/mermaid.js?1686146575"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
